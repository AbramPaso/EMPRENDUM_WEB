-- 1. TABLA DE ROLES (Jerarquía)
CREATE TABLE roles (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(20) NOT NULL -- 'Director', 'Coach', 'Colportor'
);

-- 2. TABLAS DE ESTRUCTURA (Para evitar escribir "UVOC" mal)
CREATE TABLE uniones (
    id INT PRIMARY KEY AUTO_INCREMENT,
    siglas VARCHAR(10) NOT NULL, 
    nombre_completo VARCHAR(100)
);

CREATE TABLE campos (
    id INT PRIMARY KEY AUTO_INCREMENT,
    siglas VARCHAR(10) NOT NULL, -- Ej: MVY, AVCN
    nombre_completo VARCHAR(100),
    union_id INT,
    FOREIGN KEY (union_id) REFERENCES uniones(id)
);

-- 3. TABLA DE ZONAS (Para agrupar Coaches y Colportores)
CREATE TABLE zonas (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(50) NOT NULL, -- Ej: 'Zona 1 - Yaracuy Norte'
    descripcion TEXT
);

-- 4. TABLA PRINCIPAL DE USUARIOS (Datos de Registro)
CREATE TABLE usuarios (
    id INT PRIMARY KEY AUTO_INCREMENT,
    cedula VARCHAR(20) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    nombre_completo VARCHAR(100) NOT NULL,
    sexo ENUM('M', 'F') NOT NULL,
    estado_civil ENUM('Soltero', 'Casado', 'Divorciado', 'Viudo') NOT NULL,
    religion VARCHAR(50),
    telefono VARCHAR(20),
    fecha_nacimiento DATE,
    carrera VARCHAR(100), -- Lo que estudia
    lugar_procedencia VARCHAR(100), -- Ciudad de origen
    
    -- Relaciones de Procedencia (De dónde vienen)
    union_procedencia_id INT,
    campo_procedencia_id INT,
    
    -- Jerarquía
    rol_id INT DEFAULT 3, -- Por defecto 3 es Colportor
    zona_id INT NULL, -- A qué zona pertenece (El Coach también tiene zona)
    
    fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (rol_id) REFERENCES roles(id),
    FOREIGN KEY (zona_id) REFERENCES zonas(id),
    FOREIGN KEY (union_procedencia_id) REFERENCES uniones(id),
    FOREIGN KEY (campo_procedencia_id) REFERENCES campos(id)
);

-- 5. DATOS SECUNDARIOS (Padres, Salud, Cónyuge)
CREATE TABLE datos_personales_extra (
    id INT PRIMARY KEY AUTO_INCREMENT,
    usuario_id INT UNIQUE, -- 1 a 1 con usuarios
    
    -- Padres
    padre_nombre VARCHAR(100),
    padre_telefono VARCHAR(20),
    madre_nombre VARCHAR(100),
    madre_telefono VARCHAR(20),
    
    -- Cónyuge (Si aplica)
    conyuge_nombre VARCHAR(100),
    conyuge_telefono VARCHAR(20),
    
    -- Otros
    direccion_origen TEXT,
    padecimiento_medico TEXT, -- Alergias o enfermedades
    
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id) ON DELETE CASCADE
);

-- 6. PERFIL LABORAL (Datos post-login / Misión actual)
CREATE TABLE perfil_laboral (
    id INT PRIMARY KEY AUTO_INCREMENT,
    usuario_id INT UNIQUE,
    
    foto_perfil_url VARCHAR(255),
    pensamiento_bio TEXT,
    
    -- Dónde está trabajando AHORA (puede ser diferente a su procedencia)
    lugar_colportar VARCHAR(100), -- Ej: Caracas
    union_trabajo_id INT,
    campo_trabajo_id INT,
    
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id) ON DELETE CASCADE,
    FOREIGN KEY (union_trabajo_id) REFERENCES uniones(id),
    FOREIGN KEY (campo_trabajo_id) REFERENCES campos(id)
);

-- 7. REPORTES SEMANALES (Para el Dashboard)
CREATE TABLE reportes_semanales (
    id INT PRIMARY KEY AUTO_INCREMENT,
    usuario_id INT,
    
    semana_numero INT NOT NULL, -- Ej: Semana 42
    anio INT NOT NULL,          -- Ej: 2025
    
    -- Métricas
    colecciones_vendidas INT DEFAULT 0,
    monto_dolares DECIMAL(10, 2) DEFAULT 0.00,
    horas_trabajadas DECIMAL(5, 2) DEFAULT 0.00,
    estudios_biblicos INT DEFAULT 0,
    
    fecha_envio TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id)
);

-- 8. INFORMES MENSUALES (Archivos)
CREATE TABLE informes_mensuales (
    id INT PRIMARY KEY AUTO_INCREMENT,
    usuario_id INT,
    
    mes INT NOT NULL,
    anio INT NOT NULL,
    archivo_url VARCHAR(255) NOT NULL, -- Ruta del PDF/Word
    
    fecha_subida TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id)
);










Total vendido en el año:
SELECT SUM(monto_dolares) FROM reportes_semanales 
WHERE usuario_id = ? AND anio = 2025;

Estudios bíblicos totales:
SELECT SUM(estudios_biblicos) FROM reportes_semanales 
WHERE usuario_id = ?;

